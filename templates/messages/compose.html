{% extends "layout.html" %}
{% block title %}Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© | Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="mb-1">âœ‰ï¸ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
      <small class="text-muted">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø¯Ø§Ø¦Ø±Ø© Ø£Ùˆ Ø¥Ø¯Ø§Ø±Ø©</small>
    </div>
    <div class="d-flex gap-2">
      <a href="{{ url_for('messages.inbox') }}" class="btn btn-outline-secondary">ğŸ“¥ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ§Ø±Ø¯</a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <form method="POST" novalidate>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Ø§Ù„Ø¬Ù‡Ø©</label>
            <select class="form-select" name="target_kind" id="target_kind" required>
              <option value="USER">Ù…Ø³ØªØ®Ø¯Ù…</option>
              <option value="DEPARTMENT">Ø¯Ø§Ø¦Ø±Ø©</option>
              <option value="DIRECTORATE">Ø¥Ø¯Ø§Ø±Ø©</option>
            </select>
          </div>

          <div class="col-md-8">
            <label class="form-label">Ø¥Ù„Ù‰</label>

            <select class="form-select" name="target_id" id="target_user">
              {% for u in users %}
                <option value="{{ u.id }}">{{ u.email }} ({{ u.role }})</option>
              {% endfor %}
            </select>

            <select class="form-select d-none" name="target_id" id="target_dept" disabled>
              {% for d in departments %}
                <option value="{{ d.id }}">{{ d.name_ar }}</option>
              {% endfor %}
            </select>

            <select class="form-select d-none" name="target_id" id="target_dir" disabled>
              {% for d in directorates %}
                <option value="{{ d.id }}">{{ d.name_ar }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-12">
            <label class="form-label">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input class="form-control" name="subject" maxlength="200" placeholder="Ù…Ø«Ø§Ù„: Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨/Ø§Ø³ØªÙØ³Ø§Ø±" />
          </div>

          <div class="col-12">
            <label class="form-label">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
            <textarea class="form-control" name="body" rows="6" required placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
          </div>

          <div class="col-12">
            <button class="btn btn-primary w-100">Ø¥Ø±Ø³Ø§Ù„</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
(function () {
  const kind = document.getElementById('target_kind');
  const uSel = document.getElementById('target_user');
  const dSel = document.getElementById('target_dept');
  const rSel = document.getElementById('target_dir');

  function toggle() {
    const v = (kind.value || 'USER').toUpperCase();
    // reset
    uSel.classList.add('d-none'); uSel.disabled = true;
    dSel.classList.add('d-none'); dSel.disabled = true;
    rSel.classList.add('d-none'); rSel.disabled = true;

    if (v === 'USER') { uSel.classList.remove('d-none'); uSel.disabled = false; }
    if (v === 'DEPARTMENT') { dSel.classList.remove('d-none'); dSel.disabled = false; }
    if (v === 'DIRECTORATE') { rSel.classList.remove('d-none'); rSel.disabled = false; }
  }

  kind.addEventListener('change', toggle);
  toggle();
})();
</script>
{% endblock %}
