{% extends "layout.html" %}
{% block title %}Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„Ù{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h3 class="mb-1">ğŸ¤ ØªÙØ§ØµÙŠÙ„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„Ù</h3>
        <div class="text-muted">{{ file.original_name }} (ID: {{ file.id }})</div>
      </div>
      <a class="btn btn-outline-secondary" href="{{ url_for('archive.my_files') }}">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
    </div>

    <div class="card shadow-sm">
      <div class="card-body">
        {% if perms %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                  <th>Ù…ÙÙ† Ø´Ø§Ø±ÙƒÙ‡</th>
                  <th>ØªØ­Ù…ÙŠÙ„</th>
                  <th>Ù…Ø´Ø§Ø±ÙƒØ©</th>
                  <th>Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                </tr>
              </thead>
              <tbody>
                {% for p in perms %}
                  {% set sharer = sharers.get(p.shared_by) %}
                  <tr>
                    <td>{{ p.user.email if p.user else ('User#' ~ p.user_id) }}</td>
                    <td>
                      {% if sharer %}
                        {{ sharer.email }}
                      {% elif p.shared_by %}
                        {{ 'User#' ~ p.shared_by }}
                      {% else %}
                        ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ
                      {% endif %}
                    </td>
                    <td>{{ 'Ù†Ø¹Ù…' if p.can_download else 'Ù„Ø§' }}</td>
                    <td>{{ 'Ù†Ø¹Ù…' if p.can_share else 'Ù„Ø§' }}</td>
                    <td>{{ p.expires_at.strftime('%Y-%m-%d') if p.expires_at else 'Ø¨Ø¯ÙˆÙ†' }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
