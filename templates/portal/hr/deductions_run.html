{% extends "portal/hr/base.html" %}
{% block title %}تنفيذ الخصم{% endblock %}

{% block hr_content %}
<div class="p-4 bg-white rounded-3 shadow-sm mb-3" id="dedRunPrint">
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
    <div>
      <h4 class="mb-1"><i class="bi bi-play-circle"></i> تنفيذ الخصم</h4>
      <div class="text-muted">احتساب تجميعي بسيط من (التأخير/الخروج المبكر/الغياب) اعتمادًا على سجل الدوام.</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{{ url_for('portal.hr_deductions_log') }}"><i class="bi bi-clock-history"></i> سجل الخصومات</a>
      <a class="btn btn-outline-primary" href="{{ url_for('portal.hr_deductions_settings') }}"><i class="bi bi-gear"></i> الإعدادات</a>
    </div>
  </div>
</div>

{% if cfg %}
  <div class="alert alert-info">
    <div class="d-flex flex-wrap gap-3">
      <div><strong>قيمة دقيقة التأخير:</strong> {{ cfg.late_minute_value or 0 }}</div>
      <div><strong>قيمة دقيقة الخروج المبكر:</strong> {{ cfg.early_minute_value or 0 }}</div>
      <div><strong>قيمة يوم الغياب:</strong> {{ cfg.absent_day_value or 0 }}</div>
      <div><strong>العملة:</strong> {{ cfg.currency }}</div>
    </div>
  </div>
{% else %}
  <div class="alert alert-warning">لم يتم ضبط إعدادات الخصم بعد. يمكنك ضبطها من صفحة الإعدادات.</div>
{% endif %}

<div class="bg-white rounded-3 shadow-sm p-3">
  <form method="post" class="row g-2 align-items-end">
    <div class="col-md-2">
      <label class="form-label">السنة</label>
      <input class="form-control" type="number" name="year" value="{{ year }}" min="2000" max="2100">
    </div>
    <div class="col-md-2">
      <label class="form-label">الشهر</label>
      <input class="form-control" type="number" name="month" value="{{ month }}" min="1" max="12">
    </div>
    <div class="col-md-6">
      <label class="form-label">ملاحظة</label>
      <input class="form-control" name="note" placeholder="اختياري">
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100" type="submit" {% if not can_manage %}disabled{% endif %}>
        <i class="bi bi-play"></i> تنفيذ
      </button>
    </div>
  </form>
  {% if not can_manage %}
    <div class="text-muted small mt-2">لا يمكنك التنفيذ إلا بصلاحيات الإدارة (HR Masterdata/Attendance Create).</div>
  {% endif %}
</div>
{% endblock %}
