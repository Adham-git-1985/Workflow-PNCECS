{% extends "layout.html" %}
{% block content %}

<h3 class="mb-3">ðŸ”” Notifications</h3>

<!-- Mark all as read -->
<form method="post"
      action="{{ url_for('workflow.mark_all_notifications_read') }}"
      class="mb-3">
    <button class="btn btn-sm btn-secondary">
        Mark all as read
    </button>
</form>

{% if notifications %}
<ul class="list-group">

{% for n in notifications %}
<li class="list-group-item d-flex justify-content-between align-items-center
           {% if not n.is_read %}list-group-item-warning{% endif %}">

    <div>
        <!-- Message -->
        <strong>{{ n.message }}</strong>

        <!-- Type badge -->
        {% if n.type == "CRITICAL" %}
            <span class="badge bg-danger ms-2">Critical</span>
        {% elif n.type == "WARNING" %}
            <span class="badge bg-warning text-dark ms-2">Warning</span>
        {% else %}
            <span class="badge bg-info text-dark ms-2">Info</span>
        {% endif %}

        <!-- Role badge (if role-based) -->
        {% if n.role %}
            <span class="badge bg-secondary ms-1">
                Role: {{ n.role }}
            </span>
        {% endif %}

        <!-- Time -->
        <div class="text-muted small mt-1">
            {{ n.created_at.strftime("%Y-%m-%d %H:%M") }}
        </div>
    </div>

    <!-- Actions -->
    {% if not n.is_read %}
        <button class="btn btn-sm btn-outline-secondary"
                onclick="markRead({{ n.id }})">
            Mark as read
        </button>
    {% else %}
        <span class="badge bg-success">Read</span>
    {% endif %}

</li>
{% endfor %}
</ul>

{% else %}
<div class="alert alert-info">
    No notifications yet.
</div>
{% endif %}

<!-- JS -->
<script>
function markRead(id) {
    fetch("{{ url_for('workflow.mark_notification_read', id=0) }}".replace("0", id), {
        method: "POST"
    }).then(() => location.reload());
}
</script>

{% endblock %}
