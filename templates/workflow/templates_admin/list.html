{% extends "layout.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-1">๐ ูุณุงุฑุงุช ุงูุนูู</h3>
    <small class="text-muted">ุฅุฏุงุฑุฉ ููุงูุจ ูุณุงุฑุงุช ุงูููุงููุงุช</small>
  </div>

  <div class="d-flex gap-2">
    <button type="button" class="btn btn-outline-secondary no-print" onclick="wfPrintSmart('#wfTemplatesPrint')"><i class="bi bi-printer"></i> ุทุจุงุนุฉ</button>
    <a class="btn btn-outline-secondary no-print" href="{{ url_for('users.help_workflow_guide') }}" target="_blank"><i class="bi bi-question-circle"></i> ุงูุฏููู</a>

  <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#importTemplatesModal">
    <i class="bi bi-upload"></i>
    ุงุณุชูุฑุงุฏ Excel
  </button>

<a class="btn btn-success"
     href="{{ url_for('workflow.templates_export_excel', q=q) }}">
    <i class="bi bi-file-earmark-excel"></i>
    ุชุตุฏูุฑ ุฅูู Excel
  </a>

  <a class="btn btn-primary"
     href="{{ url_for('workflow.templates_new') }}">
    โ ูุณุงุฑ ุฌุฏูุฏ
  </a>
</div>
</div>

<div class="card shadow-sm">
  <div class="card-body">

<form method="get" class="mb-3">
  <div class="input-group">
    <input class="form-control" type="text" name="q" value="{{ q or '' }}" placeholder="ุงุจุญุซ ุจุงุณู ุงููุณุงุฑโฆ">
    <button class="btn btn-outline-secondary" type="submit">ุจุญุซ</button>
    {% if q %}
      <a class="btn btn-outline-danger" href="{{ request.path }}">ูุณุญ</a>
    {% endif %}
  </div>
</form>



    {% if items %}
      <div id="wfTemplatesPrint" class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>ุงูุงุณู</th>
              <th>ูุดุท</th>
              <th>SLA ุงูุงูุชุฑุงุถู</th>
              <th class="text-end">ุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for t in items %}
            <tr>
              <td>{{ t.id }}</td>
              <td>{{ t.name }}</td>
              <td>
                {% if t.is_active %}
                  <span class="badge bg-success">ูุนู</span>
                {% else %}
                  <span class="badge bg-secondary">ูุง</span>
                {% endif %}
              </td>
              <td>{{ t.sla_days_default if t.sla_days_default is not none else '-' }}</td>
              <td class="text-end">

                <a class="btn btn-sm btn-outline-primary"
                   href="{{ url_for('workflow.templates_edit', template_id=t.id) }}">
                  โ๏ธ ุชุนุฏูู
                </a>

                <form method="post"
                      action="{{ url_for('workflow.templates_delete', template_id=t.id) }}"
                      class="d-inline"
                      onsubmit="return confirm('ุญุฐู ุงููุณุงุฑุ');">
                  <button class="btn btn-sm btn-outline-danger">
                    ๐๏ธ ุญุฐู
                  </button>
                </form>

              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-light text-center text-muted mb-0">
        ูุง ุชูุฌุฏ ูุณุงุฑุงุช ุญุงููุงู
      </div>
    {% endif %}

  </div>
</div>



<!-- Import Templates Modal -->
<div class="modal fade" id="importTemplatesModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" method="post" action="{{ url_for('workflow.templates_import_excel') }}" enctype="multipart/form-data">
      <div class="modal-header">
        <h5 class="modal-title">ุงุณุชูุฑุงุฏ ุงููุณุงุฑุงุช</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2">
          <label class="form-label">Mode</label>
          <select class="form-select" name="mode" required>
            <option value="safe" selected>Safe Replace (Upsert ุญุณุจ ุงูุงุณู)</option>
            <option value="replace">Replace (ูุณุญ + ุฅุนุงุฏุฉ ุฅุฏุฎุงู)</option>
          </select>
          <div class="form-text">ุฃุนูุฏุฉ ููุชุฑุญุฉ: name, is_active, sla_days_default</div>
        </div>
        <div class="mb-2">
          <input class="form-control" type="file" name="file" accept=".xlsx" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
        <button class="btn btn-primary">ุงุณุชูุฑุงุฏ</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}
