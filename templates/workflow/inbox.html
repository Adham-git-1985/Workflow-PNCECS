{% extends "layout.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-1">ğŸ“¥ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯ (Ø§Ù„Ù…Ù‡Ø§Ù…)</h3>
    <small class="text-muted">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ù†Ùƒ</small>
  </div>
</div>

<form method="get" class="row g-2 align-items-center mb-3">
  <div class="col-sm-7 col-md-6 col-lg-5">
    <div class="input-group">
      <span class="input-group-text"><i class="bi bi-search"></i></span>
      <input type="text"
             class="form-control"
             name="q"
             value="{{ q or '' }}"
             placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯..." />
    </div>
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-primary">Ø¨Ø­Ø«</button>
  </div>
  {% if q %}
  <div class="col-auto">
    <a class="btn btn-outline-secondary" href="{{ url_for('workflow.inbox') }}">Ø¥Ù„ØºØ§Ø¡</a>
  </div>
  {% endif %}
</form>

<div class="card shadow-sm mb-3">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
      <h5 class="mb-0"><i class="bi bi-megaphone"></i> Ø§Ù„ØªØ¹Ù…ÙŠÙ…Ø§Øª</h5>
      <a class="btn btn-sm btn-outline-primary" href="{{ url_for('workflow.circulars_list') }}">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
    </div>
    <hr class="my-3" />

    {% if last_circulars and (last_circulars|length > 0) %}
      <div class="list-group">
        {% for c in last_circulars %}
          <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center gap-2"
             href="{{ url_for('workflow.circulars_view', circular_id=c.id) }}">
            <div class="flex-grow-1">
              <div class="fw-bold">{{ c.title }}</div>
              <div class="small text-muted">{{ c.created_at.strftime('%Y-%m-%d %H:%M') if c.created_at else '' }}</div>
            </div>
            {% if c.is_urgent %}
              <span class="badge bg-danger">Ù…Ø³ØªØ¹Ø¬Ù„</span>
            {% endif %}
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù…ÙŠÙ…Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>
    {% endif %}
  </div>
</div>

{% if rows %}
<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th>Ø§Ù„Ø®Ø·ÙˆØ©</th>
          <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for req, inst, step in rows %}
        <tr>
          <td>{{ req.id }}</td>
          <td>{{ req.title }}</td>
          <td><span class="badge bg-primary">{{ req.status }}</span></td>
          <td>Step {{ step.step_order }} {% if step.mode == 'PARALLEL_SYNC' %}<span class="badge bg-info ms-2">Ù…ØªØ²Ø§Ù…Ù†</span>{% endif %}</td>
          <td>{{ req.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-primary"
               href="{{ url_for('workflow.view_request', request_id=req.id) }}">
              ÙØªØ­
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="alert alert-light text-center text-muted py-4">
  Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹ âœ…
</div>
{% endif %}

{% endblock %}
