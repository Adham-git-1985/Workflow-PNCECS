{# templates/workflow/request_attachments.html #}
{% extends "layout.html" %}
{% block title %}Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø±{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-1">ğŸ“ Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø± Ù„Ù„Ø·Ù„Ø¨ #{{ req.id }}</h3>
    <div class="text-muted small">
      <strong>{{ req.title or "" }}</strong>
      {% if template %} Â· Ø§Ù„Ù…Ø³Ø§Ø±: <strong>{{ template.name }}</strong>{% endif %}
      Â· Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª: <strong>{{ total_count }}</strong>
    </div>
  </div>

  <div class="d-flex gap-2">
    <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('workflow.view_request', request_id=req.id) }}">
      â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø·Ù„Ø¨
    </a>
    <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('workflow.request_pdf', request_id=req.id) }}">
      PDF
    </a>
  </div>
</div>

{% if not groups %}
  <div class="alert alert-light text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ÙÙ‚Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨.</div>
{% else %}
  <div class="alert alert-info">
    <div class="small">
      âœ… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„ Ù„Ù„Ù€ PDF ÙˆØ§Ù„ØµÙˆØ±. Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ØŒ Ø§Ø³ØªØ®Ø¯Ù… ØªÙ†Ø²ÙŠÙ„.
    </div>
  </div>

  {% for g in groups %}
    <div class="card shadow-sm mb-3">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <strong>{{ g.title }}</strong>
        <span class="badge bg-secondary">{{ g['items']|length }}</span>
      </div>

      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm mb-0 align-middle">
            <thead class="table-light">
              <tr>
                <th style="width:40px">#</th>
                <th>Ø§Ù„Ù…Ù„Ù</th>
                <th style="width:90px">Ø§Ù„Ù†ÙˆØ¹</th>
                <th style="width:110px">Ø§Ù„Ø­Ø¬Ù…</th>
                <th style="width:200px">Ø±ÙØ¹ Ø¨ÙˆØ§Ø³Ø·Ø©</th>
                <th style="width:160px">Ø¨ØªØ§Ø±ÙŠØ®</th>
                <th style="width:140px">Ø§Ù„Ù…ØµØ¯Ø±</th>
                <th style="width:170px">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody>
              {% for it in g['items'] %}
                <tr>
                  <td>{{ loop.index }}</td>
                  <td>
                    <strong>{{ it.name }}</strong>
                    <div class="small text-muted">{{ it.mime_type or "-" }}</div>
                  </td>
                  <td>
                    <span class="badge bg-light text-dark">{{ it.file_type or "-" }}</span>
                  </td>
                  <td>{{ it.size_human }}</td>
                  <td>{{ it.uploaded_by or "-" }}</td>
                  <td><span class="small text-muted">{{ it.uploaded_at or "-" }}</span></td>
                  <td>
                    <span class="badge bg-info text-dark">{{ it.source_label or "-" }}</span>
                  </td>
                  <td class="text-nowrap">
                    <a class="btn btn-sm btn-outline-secondary" target="_blank"
                       href="{{ url_for('workflow.preview_workflow_attachment', file_id=it.file_id) }}">
                      Ù…Ø¹Ø§ÙŠÙ†Ø©
                    </a>
                    <a class="btn btn-sm btn-outline-primary"
                       href="{{ url_for('workflow.download_workflow_attachment', file_id=it.file_id) }}">
                      ØªÙ†Ø²ÙŠÙ„
                    </a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% endfor %}
{% endif %}

{% endblock %}
