{% extends "layout.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h3 class="mb-1">ðŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
        <small class="text-muted">Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</small>
    </div>

    <form method="post"
          action="{{ url_for('workflow.mark_all_notifications_read') }}">
        <button class="btn btn-sm btn-outline-secondary">
            ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡
        </button>
    </form>
</div>

{% if notifications %}
<ul class="list-group shadow-sm">

{% for n in notifications %}
<li class="list-group-item d-flex justify-content-between align-items-start
           {% if not n.is_read %}list-group-item-warning{% endif %}">

    <div class="me-3">

        <div class="mb-1">
            <strong>{{ n.message }}</strong>

            {% if n.type == "CRITICAL" %}
                <span class="badge bg-danger ms-2">Critical</span>
            {% elif n.type == "WARNING" %}
                <span class="badge bg-warning text-dark ms-2">Warning</span>
            {% else %}
                <span class="badge bg-info text-dark ms-2">Info</span>
            {% endif %}

            {% if n.role %}
                <span class="badge bg-secondary ms-1">
                    {{ n.role }}
                </span>
            {% endif %}
        </div>

        <div class="text-muted small">
            {{ n.created_at.strftime("%Y-%m-%d %H:%M") }}
        </div>
    </div>

    <div class="text-end">
        {% if not n.is_read %}
            <button class="btn btn-sm btn-outline-primary"
                    onclick="markRead({{ n.id }})">
                ØªØ¹Ù„ÙŠÙ… ÙƒÙ…Ù‚Ø±ÙˆØ¡
            </button>
        {% else %}
            <span class="badge bg-success">Ù…Ù‚Ø±ÙˆØ¡</span>
        {% endif %}
    </div>

</li>
{% endfor %}
</ul>

{% else %}
<div class="alert alert-light text-center text-muted">
    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹
</div>
{% endif %}

<script>
function markRead(id) {
    fetch("{{ url_for('workflow.mark_notification_read', id=0) }}".replace("0", id), {
        method: "POST"
    }).then(() => location.reload());
}
</script>

{% endblock %}
