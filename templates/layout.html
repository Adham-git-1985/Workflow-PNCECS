<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Workflow System{% endblock %}</title>

    <!-- Ø§Ù„Ø®Ø· -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- CSS Ø§Ù„Ø¹Ø§Ù… -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    {% block extra_css %}{% endblock %}
</head>
<body>

<!-- Header -->
<header class="main-header">
    <div class="container">
        <h2 class="logo">Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©</h2>

        <nav class="main-nav">
            <a href="/inbox" class="{% if request.path.startswith('/inbox') %}active{% endif %}">
                Inbox</a>
            <a href="{{ url_for('my_requests') }}">ğŸ“‚ Ø·Ù„Ø¨Ø§ØªÙŠ</a>

            {% if current_user.is_authenticated and current_user.role == "admin" %}
                <a href="/audit-dashboard">Audit</a>
                <a href="/users">Users</a>
            {% endif %}
            <a href="/logout">Logout</a>

            <a href="{{ url_for('notifications') }}">
    ğŸ””
            {% if current_user.unread_notifications_count %}
                <span class="badge bg-danger">
                    {{ current_user.unread_notifications_count }}
                </span>
            {% endif %}
            </a>
            <li class="nav-item">
                <a class="nav-link position-relative"
                   href="{{ url_for('notifications') }}">
                    ğŸ””
                    {% if current_user.unread_notifications_count > 0 %}
                        <span class="position-absolute top-0 start-100
                                     translate-middle badge rounded-pill bg-danger">
                            {{ current_user.unread_notifications_count }}
                        </span>
                    {% endif %}
                </a>
            </li>


        </nav>

    </div>
</header>

<!-- Content -->
<main class="container admin-wrapper">

    {% if current_user.is_authenticated and current_user.role == "admin" %}
    <!-- Sidebar -->
<aside class="admin-sidebar">
    <h4 class="sidebar-title">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h4>

    <a href="/audit-dashboard"
       class="{% if request.path.startswith('/audit-dashboard') %}active{% endif %}">
       ğŸ“Š Audit Dashboard
    </a>

    <a href="/audit-logs"
       class="{% if request.path.startswith('/audit-logs') %}active{% endif %}">
       ğŸ“‘ Audit Logs
    </a>

    <a href="/users"
       class="{% if request.path.startswith('/users') %}active{% endif %}">
       ğŸ‘¤ Users
    </a>

    <a href="#"
       class="{% if request.path.startswith('/reports') %}active{% endif %}">
       ğŸ“ Reports
    </a>
</aside>

    {% endif %}

    <!-- Content -->
    <section class="admin-content">
        {% if breadcrumb %}
            <nav class="breadcrumb">
                {% for item in breadcrumb %}
                    {% if not loop.last %}
                        <a href="{{ item.url }}">{{ item.label }}</a>
                        <span class="sep">â€º</span>
                    {% else %}
                        <span class="current">{{ item.label }}</span>
                    {% endif %}
                {% endfor %}
            </nav>
        {% endif %}

        {% block content %}{% endblock %}
    </section>

</main>


<footer class="main-footer">
    <div class="container">
        <small>Â© Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©</small>
    </div>
</footer>

<script>
setInterval(() => {
    fetch("/notifications/unread-count")
      .then(r => r.json())
      .then(data => {
          const badge = document.getElementById("notif-badge");
          if (data.count > 0) {
              badge.innerText = data.count;
              badge.style.display = "inline-block";
          } else {
              badge.style.display = "none";
          }
      });
}, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
</script>

</body>
</html>
