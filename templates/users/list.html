{% extends "layout.html" %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-1">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</h3>
    <small class="text-muted">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªØ­Ø¯ÙŠØ« Ø£Ø¯ÙˆØ§Ø±Ù‡Ù…</small>
  </div>
  <div class="d-flex gap-2">
    <a href="{{ url_for('users.create_user') }}" class="btn btn-primary">â• Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">

    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th style="width:80px">#</th>
            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
            <th style="width:220px">Ø§Ù„Ø¯ÙˆØ±</th>
            <th style="width:200px">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
        {% for user in users %}
          {% set target_adminish = (user.role|string)|upper in ['ADMIN','SUPER_ADMIN'] %}
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.email }}</td>
            <td>
              {% if is_super_admin or not target_adminish %}
                <form method="post" action="{{ url_for('users.change_role', user_id=user.id) }}" class="d-flex gap-2">
                  <select name="role" class="form-select form-select-sm">
                    {% for r in role_choices %}
                      {% if (not is_super_admin) and (r in ['ADMIN','SUPER_ADMIN']) %}
                        {# hidden for normal admin #}
                      {% else %}
                        <option value="{{ r }}" {% if r == user.role %}selected{% endif %}>{{ r }}</option>
                      {% endif %}
                    {% endfor %}
                  </select>
                  <button class="btn btn-sm btn-outline-primary">ØªØ­Ø¯ÙŠØ«</button>
                </form>
              {% else %}
                <span class="badge bg-secondary">{{ user.role }}</span>
              {% endif %}
            </td>
            <td>
              {% if is_super_admin %}
                <a class="btn btn-sm btn-outline-dark" href="{{ url_for('users.manage_user', user_id=user.id) }}">âš™ï¸ Manage</a>
              {% else %}
                <span class="text-muted">â€”</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    {% if pagination.pages > 1 %}
    <nav>
      <ul class="pagination justify-content-center mb-0">
        {% if pagination.has_prev %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('users.list_users', page=pagination.prev_num) }}">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
          </li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">ØµÙØ­Ø© {{ pagination.page }} Ù…Ù† {{ pagination.pages }}</span>
        </li>

        {% if pagination.has_next %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('users.list_users', page=pagination.next_num) }}">Ø§Ù„ØªØ§Ù„ÙŠ</a>
          </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}

  </div>
</div>

{% endblock %}
