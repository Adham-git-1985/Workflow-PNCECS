{% extends "layout.html" %}
{% block title %}Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-1">ğŸ‘¤ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù</h3>
    <div class="text-muted">Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ù…Ù„ÙÙ‡ ÙÙŠ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©.</div>
  </div>
  <div class="d-flex gap-2 flex-wrap">
    {% if current_user.has_perm('HR_EMPLOYEE_READ') or current_user.has_perm('HR_EMPLOYEE_MANAGE') %}
      <a class="btn btn-outline-primary" href="{{ url_for('portal.hr_employee_file', user_id=u.id) }}">
        ÙØªØ­ ÙÙŠ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
      </a>
    {% endif %}
    <a class="btn btn-outline-secondary" href="{{ url_for('users.list_users') }}">â† Ø±Ø¬ÙˆØ¹</a>
  </div>
</div>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div class="d-flex align-items-center gap-3 flex-wrap">
          <img
            src="{% if u.avatar_filename %}{{ url_for('static', filename='uploads/avatars/' ~ u.avatar_filename) }}{% else %}{{ url_for('static', filename='images/avatar_default.svg') }}{% endif %}"
            alt="Avatar"
            style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:1px solid rgba(0,0,0,.15);"
          >
          <div>
            <div class="h5 mb-1">{{ u.name or "â€”" }}</div>
            <div class="text-muted">{{ u.email }}</div>
            <div class="mt-2">
              <span class="badge bg-dark">{{ u.role }}</span>
              {% if u.job_title %}<span class="badge bg-light text-dark">{{ u.job_title }}</span>{% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="mb-3">ğŸ¢ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</h5>
        <div class="row g-2">
          <div class="col-md-4">
            <div class="small text-muted">Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</div>
            <div>{{ organization.name if organization else "â€”" }}</div>
          </div>
          <div class="col-md-4">
            <div class="small text-muted">Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©</div>
            <div>{{ directorate.name_ar if directorate else "â€”" }}</div>
          </div>
          <div class="col-md-4">
            <div class="small text-muted">Ø§Ù„ÙˆØ­Ø¯Ø©</div>
            <div>{{ unit.name_ar if unit else "â€”" }}</div>
          </div>
          <div class="col-md-4">
            <div class="small text-muted">Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©</div>
            <div>{{ dept.name_ar if dept else "â€”" }}</div>
          </div>
          <div class="col-md-4">
            <div class="small text-muted">Ø§Ù„Ù‚Ø³Ù…</div>
            <div>{{ section.name_ar if section else "â€”" }}</div>
          </div>
          <div class="col-md-4">
            <div class="small text-muted">Ø§Ù„Ø´Ø¹Ø¨Ø©</div>
            <div>{{ division.name_ar if division else "â€”" }}</div>
          </div>
        </div>
        <small class="text-muted d-block mt-2">Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØ¯Ø§Ø± Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</small>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">ğŸ“„ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù (Ù…Ù† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©)</h5>
          {% if emp_file and emp_file.updated_at %}
            <small class="text-muted">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {{ emp_file.updated_at.strftime('%Y-%m-%d %H:%M') }}</small>
          {% endif %}
        </div>

        {% if emp_file %}
          <div class="row g-2 mb-3">
            <div class="col-md-4">
              <div class="small text-muted">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</div>
              <div class="fw-semibold">{{ emp_file.employee_no or "â€”" }}</div>
            </div>
            <div class="col-md-4">
              <div class="small text-muted">ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¹Ø©</div>
              <div class="fw-semibold">{{ emp_file.timeclock_code or "â€”" }}</div>
            </div>
            <div class="col-md-4">
              <div class="small text-muted">Ø§Ù„Ø¯Ø±Ø¬Ø©</div>
              <div class="fw-semibold">{{ emp_file.grade or "â€”" }}</div>
            </div>
          </div>

          <div class="border rounded-3 p-3 mb-3">
            <div class="fw-semibold mb-2">ğŸ§ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ©</div>
            <div class="row g-2">
              <div class="col-md-6"><span class="text-muted">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</span> {{ emp_file.national_id or "â€”" }}</div>
              <div class="col-md-6"><span class="text-muted">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</span> {{ emp_file.birth_date or "â€”" }}</div>
              <div class="col-md-6"><span class="text-muted">Ø§Ù„Ù‡Ø§ØªÙ:</span> {{ emp_file.phone or "â€”" }}</div>
              <div class="col-md-6"><span class="text-muted">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span> {{ emp_file.address or "â€”" }}</div>
            </div>
          </div>

          <div class="border rounded-3 p-3 mb-3">
            <div class="fw-semibold mb-2">ğŸ·ï¸ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¸ÙŠÙÙŠØ©</div>
            <div class="row g-2">
              <div class="col-md-6"><span class="text-muted">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ:</span> {{ emp_file.job_title or "â€”" }}</div>
              <div class="col-md-6"><span class="text-muted">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ¸ÙŠÙ:</span> {{ emp_file.employment_status or "â€”" }}</div>
              <div class="col-md-6"><span class="text-muted">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</span> {{ emp_file.hire_date or "â€”" }}</div>
            </div>
          </div>

          <div class="border rounded-3 p-3 mb-3">
            <div class="fw-semibold mb-2">ğŸ“‘ Ø§Ù„Ø¹Ù‚Ø¯</div>
            <div class="row g-2">
              <div class="col-md-4"><span class="text-muted">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯:</span> {{ emp_file.contract_type or "â€”" }}</div>
              <div class="col-md-4"><span class="text-muted">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù‚Ø¯:</span> {{ emp_file.contract_start or "â€”" }}</div>
              <div class="col-md-4"><span class="text-muted">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù‚Ø¯:</span> {{ emp_file.contract_end or "â€”" }}</div>
            </div>
          </div>

          <div class="border rounded-3 p-3 mb-3">
            <div class="fw-semibold mb-2">ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„Ø¨Ù†Ùƒ</div>
            <div class="row g-2">
              <div class="col-md-4"><span class="text-muted">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</span> {{ emp_file.salary_basic if emp_file.salary_basic is not none else "â€”" }}</div>
              <div class="col-md-4"><span class="text-muted">Ø§Ù„Ø¹Ù…Ù„Ø©:</span> {{ emp_file.salary_currency or "â€”" }}</div>
              <div class="col-md-6"><span class="text-muted">Ø§Ù„Ø¨Ù†Ùƒ:</span> {{ emp_file.bank_name or "â€”" }}</div>
              <div class="col-md-6"><span class="text-muted">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</span> {{ emp_file.bank_account or "â€”" }}</div>
            </div>
          </div>

          {% if emp_file.notes %}
            <div class="alert alert-secondary mb-0">
              <div class="fw-semibold mb-1">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
              <div style="white-space:pre-wrap">{{ emp_file.notes }}</div>
            </div>
          {% else %}
            <div class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª.</div>
          {% endif %}
        {% else %}
          <div class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ù…ÙˆØ¸Ù Ù…Ø³Ø¬Ù‘Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….</div>
        {% endif %}

        <div class="text-muted mt-3" style="font-size:0.9rem">Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ù…Ø³Ø§Ø±ØŒ ÙˆÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©.</div>
      </div>
    </div>

    <div class="card shadow-sm mt-3">
      <div class="card-body">
        <h5 class="mb-3">ğŸ“ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙˆØ§Ù„Ù…Ø±ÙÙ‚Ø§Øª</h5>

        {% if emp_atts and emp_atts|length > 0 %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Ø§Ù„Ù†ÙˆØ¹</th>
                  <th>Ø§Ù„Ù…Ù„Ù</th>
                  <th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
                  <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for a in emp_atts %}
                  <tr>
                    <td>
                      <span class="badge bg-secondary">{{ a.attachment_type }}</span>
                      {% if a.attachment_type == 'PAYSLIP' %}
                        <span class="badge bg-light text-dark">{{ a.payslip_period_label }}</span>
                      {% endif %}
                    </td>
                    <td class="text-truncate" style="max-width:260px">{{ a.original_name }}</td>
                    <td class="text-truncate" style="max-width:220px">{{ a.note or "â€”" }}</td>
                    <td class="text-muted">{% if a.uploaded_at %}{{ a.uploaded_at.strftime('%Y-%m-%d') }}{% else %}â€”{% endif %}</td>
                    <td class="text-end">
                      <a class="btn btn-sm btn-outline-primary" href="{{ url_for('users.user_attachment_download', user_id=u.id, att_id=a.id) }}">ØªÙ†Ø²ÙŠÙ„</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ«Ø§Ø¦Ù‚ Ù…Ø±ÙÙˆØ¹Ø©.</div>
        {% endif %}

      </div>
    </div>

  </div>
</div>

{% endblock %}
