{% extends "layout.html" %}
{% block content %}

{% set _q = q or '' %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-1">๐งฑ ุฃููุงุน ุงููููููุฉ (Dynamic)</h3>
    <small class="text-muted">ุชุนุฑูู ูุณุชููุงุช/ุฃุฌุฒุงุก ุงููููููุฉ (B: ุฃูุซุฑ ูู ููุน ุฃุจ ูุณููุญ)</small>
  </div>
  <div class="d-flex gap-2">
    <button class="btn btn-outline-secondary no-print" type="button" onclick="wfPrintSmart('#mdOrgTypePrint')">๐จ๏ธ ุทุจุงุนุฉ</button>
    <a class="btn btn-outline-secondary" target="_blank" href="{{ url_for('users.help_org_structure_dynamic_guide') }}">โ ุฏููู ุงููููููุฉ</a>
    <a class="btn btn-outline-secondary" href="{{ url_for('masterdata.org_nodes_list') }}">๐ณ ุนูุงุตุฑ ุงููููููุฉ</a>
    <a class="btn btn-primary" href="{{ url_for('masterdata.org_node_types_new') }}">โ ุฅุถุงูุฉ ููุน</a>
  </div>
</div>


<div class="card shadow-sm mb-3">
  <div class="card-body">
    <div class="row g-3 align-items-center">
      <div class="col-lg-6">
        <div class="d-flex flex-wrap align-items-center gap-3">
          <form method="post" action="{{ url_for('masterdata.org_dynamic_toggle_legacy_lock') }}" class="d-flex align-items-center gap-2">
            <input type="hidden" name="locked" value="0">
            <div class="form-check form-switch mb-0">
              <input class="form-check-input" type="checkbox" id="legacyLock" name="locked" value="1" {% if legacy_locked %}checked{% endif %} onchange="this.form.submit()">
              <label class="form-check-label" for="legacyLock">ููู ุงููููููุฉ ุงูุซุงุจุชุฉ (ูุฑุงุกุฉ ููุท)</label>
            </div>
            <span class="badge {% if legacy_locked %}bg-danger{% else %}bg-success{% endif %}">
              {% if legacy_locked %}๐ ููููุฉ{% else %}๐ ุบูุฑ ููููุฉ{% endif %}
            </span>
          </form>
          <div class="small text-muted">ุขุฎุฑ ูุฒุงููุฉ: <b>{{ last_sync or 'โ' }}</b></div>
        </div>
        <div class="small text-muted mt-2">
          <b>ูุงุฐุง ููุนู ุงููููุ</b> ูุฌุนู ุงููููููุฉ ุงููุฏููุฉ <b>ูุฑุงุกุฉ ููุท</b> (ูุนุทูู ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู/ุงูุญุฐู ูู ุตูุญุงุช ุงููููููุฉ ุงูุซุงุจุชุฉ ูุซู ุงููุฑู/ุงููุฏุฑุงุก/ุงูุชุนูููุงุช ุงููุฏููุฉ) ูููุน ุงูุชุนุงุฑุถ ุฃุซูุงุก ุงูุงูุชูุงู ุฅูู ุงููููููุฉ ุงูููุญุฏุฉ.
          <span class="text-muted">ูุง ูุญุฐู ุฃู ุจูุงูุงุช.</span>
        </div>
        <div class="small text-muted mt-2">ุงููุฒุงููุฉ ุชููู ุจุฅูุดุงุก/ุชุญุฏูุซ ุนูุงุตุฑ ุงููููููุฉ ุงูููุญุฏุฉ ูู ุงูุฌุฏุงูู ุงูุซุงุจุชุฉ. ูุง ุชุญุฐู ุงูุนูุงุตุฑ ุงูุฏููุงููููุฉ ุงูุชู ุฃูุดุฃุชูุง ูุฏูููุง.</div>
      </div>
      <div class="col-lg-6 text-lg-end">
        <form method="post" action="{{ url_for('masterdata.org_dynamic_sync_legacy') }}" class="d-inline" onsubmit="return confirm('ุณูุชู ุฌูุจ ุงููููููุฉ ูู ุงูุฌุฏุงูู ุงูุซุงุจุชุฉ ุฅูู ุงููููููุฉ ุงูููุญุฏุฉ. ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ');">
          <button class="btn btn-outline-primary"><i class="bi bi-arrow-repeat"></i> ูุฒุงููุฉ ูู ุงููููููุฉ ุงูุซุงุจุชุฉ ุงูุขู</button>
        </form>
      </div>
    </div>
  </div>
</div>


<div class="card shadow-sm">
  <div class="card-body">

    <form method="get" class="mb-3">
      <div class="input-group">
        <input class="form-control" type="text" name="q" value="{{ _q }}" placeholder="ุงุจุญุซ ุจุงูููุฏ ุฃู ุงูุงุณูโฆ">
        <button class="btn btn-outline-secondary" type="submit">ุจุญุซ</button>
        {% if _q %}
          <a class="btn btn-outline-danger" href="{{ request.path }}">ูุณุญ</a>
        {% endif %}
      </div>
    </form>

    {% if items %}
      <div id="mdOrgTypePrint" class="table-responsive">
        <table class="table table-sm align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Code</th>
              <th>ุงูุงุณู (AR)</th>
              <th>ุงูุงุณู (EN)</th>
              <th>ุชุฑุชูุจ</th>
              <th>ููุงููุงุช</th>
              <th>ูุฎุทุท</th>
              <th>ูุณุงุฑุงุช</th>
              <th>ูุดุท</th>
              <th class="text-end">ุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for t in items %}
              <tr>
                <td>{{ t.id }}</td>
                <td><code>{{ t.code }}</code></td>
                <td>{{ t.name_ar }}</td>
                <td>{{ t.name_en or '-' }}</td>
                <td>{{ t.sort_order }}</td>
                <td>{% if t.allow_in_approvals %}<span class="badge bg-success">ูุนู</span>{% else %}<span class="badge bg-secondary">ูุง</span>{% endif %}</td>
                <td>{% if t.show_in_chart %}<span class="badge bg-success">ูุนู</span>{% else %}<span class="badge bg-secondary">ูุง</span>{% endif %}</td>
                <td>{% if t.show_in_routes %}<span class="badge bg-success">ูุนู</span>{% else %}<span class="badge bg-secondary">ูุง</span>{% endif %}</td>
                <td>{% if t.is_active %}<span class="badge bg-success">ูุนู</span>{% else %}<span class="badge bg-secondary">ูุง</span>{% endif %}</td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-primary" href="{{ url_for('masterdata.org_node_types_edit', type_id=t.id) }}">โ๏ธ ุชุนุฏูู</a>
                  {% if current_user.has_perm('MASTERDATA_DELETE') %}
                  <form method="post" action="{{ url_for('masterdata.org_node_types_delete', type_id=t.id) }}" class="d-inline" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏุ ุฅุฐุง ูุงู ููุงู ุนูุงุตุฑ ูุฑุชุจุทุฉ ุณูุชู ุชุนุทููู ุจุฏูุงู ูู ุงูุญุฐู.');">
                    <button class="btn btn-sm btn-outline-danger">๐๏ธ ุญุฐู</button>
                  </form>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-light text-center text-muted mb-0">ูุง ุชูุฌุฏ ุจูุงูุงุช</div>
    {% endif %}

  </div>
</div>

{% endblock %}
