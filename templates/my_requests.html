{% extends "layout.html" %}
{% block title %}Ø·Ù„Ø¨Ø§ØªÙŠ{% endblock %}

{% block content %}

<h3>ğŸ“‚ Ø·Ù„Ø¨Ø§ØªÙŠ</h3>

<p style="color:gray; font-size:13px">
ğŸ•’ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {{ last_update.strftime("%Y-%m-%d %H:%M") }}
</p>


{% if requests %}
<div style="display:flex; gap:15px; margin-bottom:20px; flex-wrap:wrap">

  <a href="{{ url_for('my_requests', status='all') }}"
     class="counter counter-total">
      <h4>ğŸ“„ Ø§Ù„ÙƒÙ„</h4>
      <strong>{{ counters.total }}</strong>
  </a>

  <a href="{{ url_for('my_requests', status='in_progress') }}"
     class="counter counter-progress">
      <h4>ğŸ•“ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h4>
      <strong>{{ counters.in_progress }}</strong>
  </a>

  <a href="{{ url_for('my_requests', status='draft') }}"
     class="counter counter-draft">
      <h4>ğŸ’¾ Ù…Ø³ÙˆØ¯Ø©</h4>
      <strong>{{ counters.draft }}</strong>
  </a>

  <a href="{{ url_for('my_requests', status='approved') }}"
     class="counter counter-approved">
      <h4>âœ… Ù…ÙˆØ§ÙÙ‚</h4>
      <strong>{{ counters.approved }}</strong>
  </a>

  <a href="{{ url_for('my_requests', status='rejected') }}"
     class="counter counter-rejected">
      <h4>âŒ Ù…Ø±ÙÙˆØ¶</h4>
      <strong>{{ counters.rejected }}</strong>
  </a>

</div>

<canvas id="requestsChart" height="120"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('requestsChart');

new Chart(ctx, {
    type: 'pie',
    data: {
        labels: ['Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'Ù…Ø³ÙˆØ¯Ø©', 'Ù…ÙˆØ§ÙÙ‚', 'Ù…Ø±ÙÙˆØ¶'],
        datasets: [{
            data: [
                {{ counters.in_progress }},
                {{ counters.draft }},
                {{ counters.approved }},
                {{ counters.rejected }}
            ],
            backgroundColor: [
                '#f4a261',
                '#adb5bd',
                '#2a9d8f',
                '#e63946'
            ]
        }]
    }
});
</script>


<table>
    <tr>
        <th>#</th>
        <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
    </tr>

    {% for req in requests %}
    <tr>
        <td>{{ req.id }}</td>
        <td>{{ req.title }}</td>
        <td>{{ req.status }}</td>
        <td style="display:flex; gap:6px; justify-content:center">
            <a href="{{ url_for('review_request', request_id=req.id) }}"
               class="btn btn-secondary">
                ğŸ‘ Ø¹Ø±Ø¶
            </a>

            <a href="{{ url_for('request_pdf', request_id=req.id) }}"
               class="btn btn-secondary">
                ğŸ“„ PDF
            </a>

            <a href="{{ url_for('request_audit', request_id=req.id) }}"
               class="btn btn-secondary">
                ğŸ§¾ Audit
            </a>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p style="color:gray">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù‚Ù…Øª Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡Ø§ Ø¨Ø¹Ø¯.</p>
{% endif %}

{% endblock %}
