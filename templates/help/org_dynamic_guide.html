{% extends "help/_guide_base.html" %}
{% set page_title = "دليل الهيكلية الموحّدة (ديناميكية)" %}
{% set page_subtitle = "تعريف المستويات والعناصر، المزامنة من الهيكلية الثابتة، ربط الموظفين، وتأثير ذلك على المخطط والمسارات والموافقات." %}

{% block guide_body %}

<div class="alert alert-secondary py-2 mb-3">
  <div class="fw-bold">الفكرة الأساسية</div>
  <div class="small text-muted">
    بدل أن تبقى الهيكلية ثابتة ومحدودة (مديريات/دوائر/أقسام…)، أصبح بإمكانك تعريف <b>أي مستوى</b> بالاسم الذي تريد،
    وتحديد تبعيته، ثم استخدامه في: <b>المخطط الهيكلي</b> و<b>المسارات/قواعد التوجيه</b> و<b>الموافقات</b>.
  </div>
</div>

<details open>
  <summary><strong>١) الصفحات الأساسية</strong></summary>
  <div class="mt-2">
    <ul>
      <li><b>أنواع الهيكلية (Dynamic):</b> تعريف “المستويات” (مثال: إدارة عامة، دائرة، قسم، فريق…)
        <div class="text-muted small">لوحة الإدارة → ثوابت النظام → أنواع الهيكلية (Dynamic)</div>
      </li>
      <li><b>عناصر الهيكلية (Dynamic):</b> تعريف “العناصر” الفعلية وربطها بالأب عبر شجرة اختيار.
        <div class="text-muted small">لوحة الإدارة → ثوابت النظام → عناصر الهيكلية (Dynamic)</div>
      </li>
      <li><b>تعيين الموظفين على الهيكلية الموحدة:</b> ربط الموظف بعنصر OrgNode (أساسي/إضافي).
        <div class="text-muted small">البوابة الإدارية → HR → الهيكلية الموحدة → تعيين الموظفين</div>
      </li>
    </ul>
  </div>
</details>

<details>
  <summary><strong>٢) أنواع الهيكلية: ماذا تعني خيارات (الموافقات/المخطط/المسارات)؟</strong></summary>
  <div class="mt-2">
    <ul>
      <li><b>الدخول في مسارات الموافقات</b>: يسمح باستخدام هذا النوع داخل خطوات الاعتماد (ORG_NODE / اختيار جهة معتمدة).</li>
      <li><b>الظهور في المخطط الهيكلي</b>: يجعل عناصر هذا النوع تظهر عند عرض المخطط/الشجرة التنظيمية.</li>
      <li><b>الظهور في المسارات</b>: يجعل عناصر هذا النوع تظهر داخل شجرة الاختيار في قواعد التوجيه والمسارات.</li>
      <li><b>تحديد الآباء المسموحين</b>: أهم جزء في (B). أنت تحدد لأي نوع: من هم “الآباء” المسموحين له.
        <div class="text-muted small">هذا ينعكس مباشرة على شجرة اختيار الأب، وعلى منطق “Subtree” في التوجيه.</div>
      </li>
    </ul>
  </div>
</details>

<details>
  <summary><strong>٣) إضافة عنصر جديد وتبعيته (شجرة اختيار الأب)</strong></summary>
  <div class="mt-2">
    <ol>
      <li>اذهب إلى: <b>عناصر الهيكلية (Dynamic)</b> ثم <b>إضافة عنصر</b>.</li>
      <li>اختر <b>نوع العنصر</b> (OrgNodeType).</li>
      <li>اختر <b>الأب</b> من الشجرة (حسب الآباء المسموحين في نوعك).</li>
      <li>احفظ. سيصبح العنصر جاهزًا للظهور حسب إعدادات النوع.</li>
    </ol>
    <div class="alert alert-light mb-0 small">
      <b>مهم:</b> إذا لم يظهر العنصر في المسارات/الموافقات، فغالبًا السبب هو أن نوعه غير مفعّل بخيارات (المسارات/الموافقات)، أو أنه غير نشط.
    </div>
  </div>
</details>

<details>
  <summary><strong>٤) المزامنة + قفل الهيكلية الثابتة</strong></summary>
  <div class="mt-2">
    <ul>
      <li><b>مزامنة من الهيكلية الثابتة الآن:</b> تقوم بإنشاء/تحديث OrgNodes من الجداول الثابتة (Legacy → Dynamic).
        <div class="text-muted small">لا تحذف العناصر الديناميكية التي أنشأتها يدويًا.</div>
      </li>
      <li><b>قفل الهيكلية الثابتة (قراءة فقط):</b> يمنع الإضافة/التعديل/الحذف في صفحات الهيكلية القديمة لتجنب التعارض أثناء الانتقال للهيكلية الموحدة.</li>
    </ul>
  </div>
</details>

<details>
  <summary><strong>٥) تعيين موظف على عنصر: هل يؤثر على التوجيه؟</strong></summary>
  <div class="mt-2">
    <ul>
      <li>نعم. عند تعيين الموظف على OrgNode (أساسي)، يصبح هذا مرجعًا قويًا لقواعد التوجيه (Routing) ولتحديد “جهة الموظف”.</li>
      <li>إذا كانت القاعدة تستخدم <b>Subtree</b> (يشمل الفروع)، فكل العناصر التابعة للأب تُحسب ضمن المطابقة.</li>
    </ul>
  </div>
</details>

<details>
  <summary><strong>٦) الموافقات الإدارية: كيف يدخل OrgNode في الاعتماد؟</strong></summary>
  <div class="mt-2">
    <ul>
      <li>إذا كانت خطوة الاعتماد تعتمد على <b>ORG_NODE</b>، فالاعتماد عادة يكون “مدير/نائب” هذا العنصر (حسب تعريف المدراء على العنصر).</li>
      <li>لذلك: <b>تعيين الموظف</b> يحدد “أين يقع الموظف”، و<b>تعيين مدير/نائب للعنصر</b> يحدد “من يوافق”.</li>
    </ul>
  </div>
</details>

<details>
  <summary><strong>٧) استكشاف سريع للأخطاء الشائعة</strong></summary>
  <div class="mt-2">
    <ul>
      <li><b>العنصر لا يظهر في المسارات/قواعد التوجيه:</b> تأكد من (Show in routes) في نوعه + أنه نشط.</li>
      <li><b>لا يمكن اختيار الأب:</b> نوع العنصر لا يسمح بهذا الأب (قائمة الآباء المسموحين).</li>
      <li><b>الموافقة لا تصل للشخص الصحيح:</b> تأكد من تعريف مدير/نائب لعنصر OrgNode المستخدم في خطوة الاعتماد.</li>
    </ul>
  </div>
</details>

{% endblock %}
