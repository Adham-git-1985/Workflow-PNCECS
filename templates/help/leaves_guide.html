{% extends 'layout.html' %}

{% block title %}دليل الإجازات{% endblock %}

{% block extra_css %}
<style>
  .guide-wrap{max-width:1100px;margin:0 auto}
  .guide-hero{background:linear-gradient(180deg, rgba(184,134,11,.14), rgba(0,0,0,0));border:1px solid rgba(0,0,0,.07);border-radius:16px}
  .guide-hero h1{font-weight:800;letter-spacing:.2px}
  .guide-hero .meta{color:rgba(0,0,0,.6)}
  .guide-card{border:1px solid rgba(0,0,0,.07);border-radius:14px}
  .guide-card .card-header{background:rgba(0,0,0,.02);border-bottom:1px solid rgba(0,0,0,.06)}
  .guide-toc a{color:inherit;text-decoration:none}
  .guide-toc a:hover{text-decoration:underline}
  .guide-list li{margin-bottom:.35rem}
  .badge-soft{background:rgba(13,110,253,.10);color:#0d6efd;border:1px solid rgba(13,110,253,.18)}
  @media print{
    .no-print{display:none !important}
    .admin-sidebar,.main-header{display:none !important}
    .admin-wrapper{padding:0 !important}
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="guide-wrap">

    <div class="guide-hero p-4 p-md-5 mb-4">
      <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
        <div>
          <h1 class="mb-2">دليل الإجازات</h1>
          <div class="meta">شرح عملي وواضح لتقديم الإجازات، المرفقات، الإلغاء، الخصم من الرصيد، والتقارير والتنبيهات الذكية.</div>
          <div class="meta mt-1">مخصص للموظفين ولمسؤولي الموارد البشرية داخل اللجنة الوطنية الفلسطينية للتربية والثقافة والعلوم.</div>
        </div>
        <div class="d-flex gap-2 no-print">
          <a class="btn btn-outline-primary" href="{{ url_for('static', filename='docs/leave_guide_ar.docx') }}">
            <i class="bi bi-download"></i>
            تنزيل نسخة وورد
          </a>
          <button class="btn btn-primary" onclick="window.print()">
            <i class="bi bi-printer"></i>
            طباعة
          </button>
        </div>
      </div>

      <div class="guide-toc mt-4">
        <div class="row g-2">
          <div class="col-12 col-md-4"><a href="#emp" class="d-block p-2 bg-white rounded-3 border">للموظفين: تقديم ومتابعة وإلغاء</a></div>
          <div class="col-12 col-md-4"><a href="#docs" class="d-block p-2 bg-white rounded-3 border">المرفقات: رفع تقرير واحد أو عدة تقارير</a></div>
          <div class="col-12 col-md-4"><a href="#hr" class="d-block p-2 bg-white rounded-3 border">للموارد البشرية: الأنواع والأرصدة والتقارير والتنبيهات</a></div>
        </div>
      </div>
    </div>

    <ul class="nav nav-pills mb-3 no-print" id="pills-tab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="pills-emp-tab" data-bs-toggle="pill" data-bs-target="#pills-emp" type="button" role="tab">إرشادات الموظف</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-hr-tab" data-bs-toggle="pill" data-bs-target="#pills-hr" type="button" role="tab">إرشادات الموارد البشرية</button>
      </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">

      <!-- ===================== Employee Guide ===================== -->
      <div class="tab-pane fade show active" id="pills-emp" role="tabpanel" aria-labelledby="pills-emp-tab">

        <div id="emp" class="card guide-card mb-3">
          <div class="card-header"><strong>١) الوصول إلى خدمة الإجازات</strong></div>
          <div class="card-body">
            <ul class="guide-list">
              <li>من القائمة الجانبية اختر: <span class="badge badge-soft">البوابة الإدارية</span> ثم <span class="badge badge-soft">الموارد البشرية</span> ثم <span class="badge badge-soft">الإجازات</span>.</li>
              <li>ستجد صفحات أساسية: <strong>طلب إجازة جديد</strong> و<strong>إجازاتي</strong>، وقد تظهر صفحات إضافية بحسب صلاحيتك.</li>
            </ul>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٢) تقديم طلب إجازة جديد</strong></div>
          <div class="card-body">
            <ol class="guide-list">
              <li>اذهب إلى: الموارد البشرية ← الإجازات ← <strong>طلب إجازة جديد</strong>.</li>
              <li>اختر نوع الإجازة (شخصية، مرضية، طارئة… إلخ).</li>
              <li>حدّد تاريخ البداية وتاريخ النهاية.</li>
              <li>اكتب ملاحظة مختصرة عند الحاجة (اختياري).</li>
              <li>إذا كان نوع الإجازة يتطلب مستندًا (مثل المرضية)، ارفع التقرير/التقارير ضمن خانة المرفقات.</li>
              <li>اضغط <strong>إرسال الطلب</strong>. بعدها يظهر الطلب في صفحة <strong>إجازاتي</strong>.</li>
            </ol>
            <div class="alert alert-info mb-0">
              <strong>مهم:</strong> إذا كان نوع الإجازة يتطلب مرفقات، فلن يسمح النظام بإرسال الطلب دون رفع مستند واحد على الأقل.
            </div>
          </div>
        </div>

        <div id="docs" class="card guide-card mb-3">
          <div class="card-header"><strong>٣) المرفقات: رفع تقرير واحد أو عدة تقارير (قبل أو بعد الإرسال)</strong></div>
          <div class="card-body">
            <p class="mb-2">يمكنك رفع مرفق واحد أو عدة مرفقات بطريقتين:</p>
            <ul class="guide-list">
              <li><strong>أثناء إنشاء الطلب:</strong> من خانة المرفقات في صفحة (طلب إجازة جديد).</li>
              <li><strong>بعد إنشاء الطلب:</strong> من صفحة (إجازاتي) افتح الطلب ثم اختر (إضافة مرفقات) وارفع الملفات المطلوبة.</li>
            </ul>
            <div class="alert alert-warning mb-0">
              <strong>تنبيه:</strong> بعد بدء الإجازة تستطيع إضافة تقارير جديدة عند الحاجة، لكن لا يمكنك إلغاء الإجازة بنفسك بعد بدء تاريخها.
            </div>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٤) متابعة الطلب</strong></div>
          <div class="card-body">
            <ul class="guide-list">
              <li>اذهب إلى: الموارد البشرية ← الإجازات ← <strong>إجازاتي</strong>.</li>
              <li>سترى حالة الطلب: بانتظار الإجراء / معتمد / مرفوض / ملغى.</li>
              <li>افتح الطلب لعرض التفاصيل، وقرار الاعتماد، والملاحظات، والمرفقات وروابط تنزيلها.</li>
            </ul>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٥) الإلغاء (قبل أو بعد الاعتماد)</strong></div>
          <div class="card-body">
            <ul class="guide-list">
              <li>يمكنك إلغاء طلب الإجازة طالما <strong>لم يبدأ تاريخ الإجازة بعد</strong>، حتى لو كان الطلب معتمدًا.</li>
              <li>بعد بدء تاريخ الإجازة: <strong>لا يمكن الإلغاء إلا بواسطة مسؤول الموارد البشرية</strong>.</li>
            </ul>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٦) كيف يتم خصم الإجازة من الرصيد</strong></div>
          <div class="card-body">
            <ul class="guide-list">
              <li>لا يتم خصم أي يوم من الرصيد قبل اعتماد طلب الإجازة.</li>
              <li>بعد الاعتماد: يتم الخصم <strong>يومًا بيوم</strong> ابتداءً من تاريخ البداية؛ أي يُحتسب فقط عدد الأيام التي مضت حتى تاريخ اليوم.</li>
              <li>الأيام المستقبلية داخل نفس الطلب لا تُخصم قبل حلولها.</li>
              <li>عند الإلغاء قبل البداية: لا يتم خصم أي شيء.</li>
              <li>عند الإلغاء بعد البداية (بواسطة الموارد البشرية): يتوقف الخصم عند تاريخ الإلغاء الفعّال.</li>
            </ul>
          </div>
        </div>

        <div class="card guide-card mb-4">
          <div class="card-header"><strong>٧) التنبيهات الذكية التي تصل للموظف</strong></div>
          <div class="card-body">
            <ul class="guide-list mb-0">
              <li>إشعار عند اعتماد الطلب أو رفضه أو إلغائه.</li>
              <li>تنبيه عند انخفاض الرصيد المتبقي من نوع إجازة معين (حسب إعدادات النظام).</li>
              <li>تنبيه عند محاولة إرسال طلب يتطلب مرفقات دون رفع مستندات.</li>
            </ul>
          </div>
        </div>

      </div>

      <!-- ===================== HR Guide ===================== -->
      <div class="tab-pane fade" id="pills-hr" role="tabpanel" aria-labelledby="pills-hr-tab">

        <div id="hr" class="card guide-card mb-3">
          <div class="card-header"><strong>١) تعريف أنواع الإجازات</strong></div>
          <div class="card-body">
            <p class="mb-2">من: الموارد البشرية ← إعدادات الدوام ← <strong>أنواع الإجازات</strong>.</p>
            <ul class="guide-list">
              <li>تحديد الاسم والرمز والتفعيل/التعطيل.</li>
              <li>تحديد ما إذا كان النوع يتطلب اعتمادًا.</li>
              <li>الحد الطبيعي لمدة الإجازة (بالأيام).</li>
              <li>الرصيد السنوي الافتراضي (بالأيام).</li>
              <li><strong>حالات استثنائية:</strong> حد استثنائي أعلى، وهل يتطلب اعتماد الموارد البشرية، وهل يلزم إدخال ملاحظة قرار.</li>
              <li><strong>المرفقات:</strong> هل يتطلب هذا النوع تقريرًا/مستندًا؟ مع كتابة رسالة توجيه تظهر للموظف.</li>
            </ul>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٢) الرصيد السنوي حسب الدرجة الإدارية</strong></div>
          <div class="card-body">
            <ol class="guide-list">
              <li>افتح نوع الإجازة المطلوب.</li>
              <li>اذهب إلى قسم: <strong>الرصيد السنوي حسب الدرجة</strong>.</li>
              <li>أضف صفًا لكل درجة: (الدرجة) و(عدد الأيام المسموحة).</li>
              <li>تأكد أن قيمة الدرجة تطابق قيمة الدرجة في ملف الموظف داخل البوابة الإدارية.</li>
            </ol>
            <div class="alert alert-secondary mb-0">
              <strong>أولوية احتساب الرصيد:</strong> رصيد خاص للموظف (إن وُجد) ← رصيد حسب الدرجة ← الرصيد الافتراضي لنوع الإجازة.
            </div>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٣) إدارة أرصدة الإجازات للموظفين</strong></div>
          <div class="card-body">
            <ul class="guide-list mb-0">
              <li>من صفحة أرصدة الإجازات يمكن إدخال أو تعديل رصيد سنوي لموظف وسنة محددين.</li>
              <li>يُستخدم الرصيد الخاص للتسويات أو الحالات الاستثنائية أو القرارات الإدارية.</li>
            </ul>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٤) اعتماد الإجازات ومراجعة المرفقات</strong></div>
          <div class="card-body">
            <ul class="guide-list">
              <li>عند فتح الطلب ستظهر جميع تفاصيله مع قائمة المرفقات وروابط تنزيلها.</li>
              <li>في الحالات الاستثنائية (مدة تتجاوز الحد الطبيعي) قد يشترط النظام اعتماد الموارد البشرية وقد يلزم إدخال ملاحظة قرار.</li>
              <li>بعد الاعتماد يبدأ الخصم يومًا بيوم ابتداءً من تاريخ بداية الإجازة.</li>
            </ul>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٥) الإلغاء بعد بدء الإجازة (صلاحية الموارد البشرية فقط)</strong></div>
          <div class="card-body">
            <ol class="guide-list">
              <li>افتح طلب الإجازة المعتمد.</li>
              <li>اختر إجراء: <strong>إلغاء بواسطة الموارد البشرية</strong>.</li>
              <li>حدّد تاريخ الإلغاء الفعّال (آخر يوم يتم احتسابه).</li>
              <li>اكتب ملاحظة سبب الإلغاء (موصى به).</li>
            </ol>
          </div>
        </div>

        <div class="card guide-card mb-3">
          <div class="card-header"><strong>٦) ساعات المغادرات المسموحة والتقرير الشهري</strong></div>
          <div class="card-body">
            <ul class="guide-list">
              <li>يمكن تحديد ساعات سماح افتراضية للمغادرات من إعدادات التقرير الشهري.</li>
              <li>يمكن تخصيص ساعات سماح لموظف محدد لشهر محدد.</li>
              <li>الزائد عن الساعات المسموحة يتم تحويله إلى جزء من يوم ويُخصم من نوع إجازة محدد في الإعدادات.</li>
            </ul>
            <div class="alert alert-info mb-0">
              <strong>مثال:</strong> السماح ٦ ساعات، الاستخدام ٩ ساعات، الزائد ٣ ساعات. إذا كان يوم العمل ٨ ساعات، فالخصم يعادل ٣/٨ يوم.
            </div>
          </div>
        </div>

        <div class="card guide-card mb-4">
          <div class="card-header"><strong>٧) التنبيهات الذكية الخاصة بالموارد البشرية</strong></div>
          <div class="card-body">
            <ul class="guide-list">
              <li><strong>تنبيه الطلبات المعلّقة:</strong> إذا بقي الطلب بانتظار الإجراء أكثر من عدد أيام محدد، يرسل النظام تنبيهًا لمسؤولي الموارد البشرية ولمُعتمد الطلب (وبحد أقصى مرة كل ٢٤ ساعة لكل طلب).</li>
              <li><strong>تنبيه انخفاض الرصيد:</strong> عند اقتراب رصيد إجازات الموظف من حد منخفض يظهر التنبيه ضمن صفحة التنبيهات الذكية.</li>
              <li>يمكن ضبط حدود التنبيه من إعدادات الدوام.</li>
            </ul>
          </div>
        </div>

      </div>

    </div>

    <div class="text-center text-muted small mt-3">
      هذا الدليل متاح داخل النظام من القائمة الجانبية: <strong>المساعدة ← دليل الإجازات</strong>.
    </div>

  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
